<div id="custom-audio-player" role="region" aria-label="音樂播放器和播放列表">
    <h3>我的音樂播放器</h3>
    
    <audio id="main-audio" controls>
        您的瀏覽器不支持 HTML5 音頻。
    </audio>
    
    <div id="player-controls" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;">
        
        <div id="nav-main-group" style="display: flex; justify-content: center; align-items: center; gap: 15px;">
            <button id="prev-button" onclick="playPreviousTrack()" 
                    style="cursor: pointer; font-size: 1.2em; border: none; background: none;" 
                    aria-label="播放上一曲">
                ⏪ 上一曲
            </button>
            
            <button id="mode-button" onclick="togglePlayMode()" 
                    style="cursor: pointer; border: none; background: none;" 
                    aria-live="polite" aria-label="切換播放模式">
                [ 模式: 順序 ]
            </button>
            
            <button id="next-button" onclick="playNextTrack()" 
                    style="cursor: pointer; font-size: 1.2em; border: none; background: none;" 
                    aria-label="播放下一曲">
                下一曲 ⏩
            </button>
        </div>
        
        <div id="mode-switcher-group" style="display: flex; justify-content: center; margin-top: 5px;">
            <div id="data-mode-switcher">
                <button id="data-mode-toggle-btn" onclick="toggleDataMode()" style="cursor: pointer;" aria-live="polite">
                    數據模式: <span id="current-data-mode">[本地統計]</span>
                </button>
            </div>
        </div>

        <div id="aux-controls-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
            
            <div id="theme-switcher" style="position: relative;">
                <button id="theme-toggle-btn" style="cursor: pointer;" aria-expanded="false" aria-controls="theme-menu">
                    主題：<span id="current-theme-name">白色 (自動)</span>
                </button>
                <div id="theme-menu" class="hidden-menu" role="menu" style="position: absolute; z-index: 10; left: 0;">
                    <span class="theme-option" data-theme="light" role="menuitem" tabindex="0">白色</span>
                    <span class="theme-option" data-theme="dark" role="menuitem" tabindex="0">黑色</span>
                    <span class="theme-option" data-theme="grey" role="menuitem" tabindex="0">灰色</span>
                    <span class="theme-option" data-theme="blue" role="menuitem" tabindex="0">藍色</span>
                    <span class="theme-option" data-theme="green" role="menuitem" tabindex="0">綠色</span>
                    <span class="theme-option" data-theme="purple" role="menuitem" tabindex="0">紫色</span>
                    <span class="theme-option" data-theme="pink" role="menuitem" tabindex="0">粉色</span>
                    <span class="theme-option" data-theme="yellow" role="menuitem" tabindex="0">黄色</span>
                    <span class="theme-option" data-theme="red" role="menuitem" tabindex="0">紅色</span>
                </div>
            </div>
            
            <div id="sleep-timer-area" style="position: relative;">
                <button id="timer-toggle-btn" style="cursor: pointer;" aria-expanded="false" aria-controls="timer-menu">
                    定時 (未設定)
                </button>
                
                <div id="timer-menu" class="hidden-menu" role="menu" style="position: absolute; z-index: 10; right: 0;">
                    <span class="menu-item" onclick="setSleepTimer(10);" role="menuitem" tabindex="0">10 分鐘後關閉</span>
                    <span class="menu-item" onclick="setSleepTimer(30);" role="menuitem" tabindex="0">30 分鐘後關閉</span>
                    <span class="menu-item" onclick="setSleepTimer(60);" role="menuitem" tabindex="0">60 分鐘後關閉</span>
                    <span class="menu-item" onclick="clearSleepTimer(); toggleTimerMenu();" role="menuitem" tabindex="0">取消定時</span>
                </div>
            </div>
        </div>
        
    </div> 
    <div id="search-area">
        <input type="text" id="playlist-search" placeholder="🔎 搜尋歌曲或歌手..." aria-label="搜尋歌曲或歌手">
    </div>
        
    <div id="stats-bar">
        <span role="status" aria-live="polite">總時長: <span id="total-listen-time">0 分鐘</span></span>
        <span role="status" aria-live="polite">剩餘: <span id="remaining-timer">--:--</span></span>
    </div>

    <div id="lyrics-container" class="lyrics-container">
        <div id="lyrics-content" class="lyrics-content">
            <p id="lyrics-placeholder">載入中... 請選擇一首歌曲播放。</p>
        </div>
    </div>
    
    <ul id="playlist" role="list">
    </ul>
</div>

<script>
    // ⭐️ Liquid 數據層：將數據注入到全局變量供模組使用
    window.PLAYER_GLOBAL_DATA = {
        trackDataArray: {{ site.data.music | jsonify }}
    };
</script>

<script type="module" src="/assets/js/main.js"></script>

<script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/service-worker.js")
            .then(reg => console.log("SW 註冊成功", reg))
            .catch(err => console.error("SW 註冊失敗", err));
    }
</script>
