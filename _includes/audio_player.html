<div id="custom-audio-player">
    <h3>我的音樂播放器</h3>
    
    <audio id="main-audio" controls>
        您的瀏覽器不支持 HTML5 音頻。
    </audio>
    
    <div id="player-controls" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px;">
        
        <div id="nav-main-group" style="display: flex; justify-content: center; align-items: center; gap: 15px;">
            <span id="prev-button" onclick="playPreviousTrack()" style="cursor: pointer; font-size: 1.2em;">
                ⏪ 上一曲
            </span>
            <span id="mode-button" onclick="togglePlayMode()" style="cursor: pointer;">
                [ 模式: 順序 ]
            </span>
            <span id="next-button" onclick="playNextTrack()" style="cursor: pointer; font-size: 1.2em;">
                下一曲 ⏩
            </span>
        </div>
        
        <div id="mode-switcher-group" style="display: flex; justify-content: center; margin-top: 5px;">
            <div id="data-mode-switcher">
                <button id="data-mode-toggle-btn" onclick="toggleDataMode()" style="cursor: pointer;">
                    數據模式: <span id="current-data-mode">[本地統計]</span>
                </button>
            </div>
        </div>

        <div id="aux-controls-group" style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
            
            <div id="theme-switcher" style="position: relative;">
                <button id="theme-toggle-btn" style="cursor: pointer;">
                    主題：<span id="current-theme-name">白色 (自動)</span>
                </button>
                <div id="theme-menu" class="hidden-menu" style="position: absolute; z-index: 10; left: 0;">
                    <span class="theme-option" data-theme="light">白色</span>
                    <span class="theme-option" data-theme="dark">黑色</span>
                    <span class="theme-option" data-theme="grey">灰色</span>
                    <span class="theme-option" data-theme="blue">藍色</span>
                    <span class="theme-option" data-theme="green">綠色</span>
                    <span class="theme-option" data-theme="purple">紫色</span>
                    <span class="theme-option" data-theme="pink">粉色</span>
                    <span class="theme-option" data-theme="yellow">黄色</span>
                    <span class="theme-option" data-theme="red">紅色</span>
                </div>
            </div>
            
            <div id="sleep-timer-area" style="position: relative;">
                <button id="timer-toggle-btn" onclick="toggleTimerMenu()" style="cursor: pointer;">
                    定時 (未設定)
                </button>
                
                <div id="timer-menu" class="hidden-menu" style="position: absolute; z-index: 10; right: 0;">
                    <span class="menu-item" onclick="setSleepTimer(10)">10 分鐘後關閉</span>
                    <span class="menu-item" onclick="setSleepTimer(30)">30 分鐘後關閉</span>
                    <span class="menu-item" onclick="setSleepTimer(60)">60 分鐘後關閉</span>
                    <span class="menu-item" onclick="clearSleepTimer(); toggleTimerMenu();">取消定時</span>
                </div>
            </div>
        </div>
        
    </div> 
    <div id="search-area">
    <input type="text" id="playlist-search" placeholder="🔎 搜尋歌曲或歌手..." aria-label="搜尋歌曲或歌手">
</div>
    
<div id="stats-bar">
    <span>總時長: <span id="total-listen-time">0 分鐘</span></span>
    <span>剩餘: <span id="remaining-timer">--:--</span></span>
</div>
<ul id="playlist">
    </ul>
</div>

<script>
    // ⭐️ Liquid 數據層：將數據注入到全局變量供模組使用
    // 這是唯一保留在 HTML 中的非模組 JS。
    window.PLAYER_GLOBAL_DATA = {
        trackDataArray: {{ site.data.music | jsonify }}
    };
</script>

<script type="module" src="/assets/js/Config.js"></script>
<script type="module" src="/assets/js/StateAndUtils.js"></script>
<script type="module" src="/assets/js/PlayerCore.js"></script>

<script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/service-worker.js")
            .then(reg => console.log("SW 註冊成功", reg))
            .catch(err => console.error("SW 註冊失敗", err));
    }
</script>
