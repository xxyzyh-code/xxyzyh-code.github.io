# .github/workflows/cpanel_deploy.yml
# å°ˆé–€ç”¨æ–¼æ§‹å»º Jekyll ä¸¦é€é FTP éƒ¨ç½²åˆ° cPanel ä¼ºæœå™¨

name: Deploy to cPanel via FTP

on:
  # ç•¶ push åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼è‡ªå‹•éƒ¨ç½²
  push:
    branches: ["main"]
  # ä¹Ÿå…è¨±æ‰‹å‹•å¾ GitHub ä»‹é¢è§¸ç™¼
  workflow_dispatch:

permissions:
  contents: read

jobs:
  cpanel_deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      # ç¢ºä¿ä½¿ç”¨èˆ‡æ‚¨ Jekyll å°ˆæ¡ˆç›¸ç¬¦çš„ Ruby ç‰ˆæœ¬ (æ‚¨ä¹‹å‰ä½¿ç”¨çš„æ˜¯ 3.2)
      - name: Setup Ruby (Required for Jekyll Build)
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.2'
          bundler-cache: true  # å®‰è£ Gemfile.lock ä¸­çš„ä¾è³´

      - name: Build Jekyll Site
        run: bundle exec jekyll build
        env:
          JEKYLL_ENV: production
      
      - name: ğŸš€ Deploy built files to cPanel /public_html (é¨™é FTP Action)
        # ğŸš¨ æ›å›ç¬¬ä¸€å€‹ Actionï¼Œå› ç‚ºå®ƒæ˜¯æœ€ç©©å®šçš„ã€‚
        uses: SamKirkland/FTP-Deploy-Action@v4.3.0 
        with:
          # é€£æ¥è³‡è¨Š (ä¿æŒä¸è®Š)
          server: ${{ secrets.FTP_HOST }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          
          # ğŸš¨ é—œéµä¿®æ­£é»ï¼š
          # æ¬ºé¨™ Action ä½¿ç”¨ FTP (å®ƒä¸èªè­˜ SFTP)
          protocol: ftp 
          # å‘Šè¨´å®ƒç”¨ SSH ç«¯å£ 22
          port: 22 
          
          # ç¢ºä¿è·¯å¾‘æ˜¯æ­£ç¢ºçš„ (æˆ‘å€‘ç”¨å®ƒè¦æ±‚çš„ local-dir å’Œ server-dir)
          local-dir: ./_site/
          server-dir: /public_html/
          
          # åˆªé™¤é ç«¯ä¸å†éœ€è¦çš„èˆŠæ–‡ä»¶ (ä¿æŒ public_html ä¹¾æ·¨)
          state-name: .ftp-deploy-sync-state.json
          log-level: verbose
          # æ¸…ç† public_html é¿å… Index of / éŒ¯èª¤
          exclude: |
            **/.git*
            **/.DS_Store
            **/.cpanel.yml
