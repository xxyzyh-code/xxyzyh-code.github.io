name: Sync Jekyll to GitLab Pages

on:
  push:
    branches: [main]

jobs:
  sync-to-gitlab: # æ›´æ”¹ä»»å‹™åç¨±ï¼Œåæ‡‰æˆ‘å€‘åªåšåŒæ­¥
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout GitHub repo
        uses: actions/checkout@v4 # æ¨è–¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

      # ----------------------------------------------------
      # åˆªé™¤ Jekyll å»ºç½®å’Œ Ruby å®‰è£æ­¥é©Ÿ
      # å› ç‚º Jekyll å»ºç½®å°‡åœ¨ GitLab CI/CD ä¸­å®Œæˆ
      # ----------------------------------------------------

      - name: ğŸ”„ Deploy to GitLab
        env:
          GITLAB_TOKEN: ${{ secrets.GITLAB_TOKEN }}
          # æ›¿æ›æˆä½ çš„ GitLab ä½¿ç”¨è€…åç¨±
          GITLAB_REPO: https://xxyzyh:${{ secrets.GITLAB_TOKEN }}@gitlab.com/xxyzyh/my-blog.git 
        run: |
          # è¨­ç½® Git èº«ä»½
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          
          # ğŸš¨ é™¤éŒ¯æ­¥é©Ÿï¼šå®‰å…¨åœ°åˆ—å°å‡ºç”¨æ–¼æ¨é€çš„ URL 
          # é€™è£¡ä½¿ç”¨ sed å°‡ Token æ›¿æ›ç‚º ***** ä»¥ä¿è­·ä½ çš„å¯†ç¢¼
          echo "Debugging URL (Token hidden):"
          echo $GITLAB_REPO | sed "s/${{ secrets.GITLAB_TOKEN }}/*****/"
          
          # æ·»åŠ é ç¨‹å€‰åº«ä¸¦æ¨é€
          git remote add gitlab $GITLAB_REPO
          echo "ğŸš€ Pushing code to GitLab repository..."
          # å†æ¬¡å˜—è©¦æ¨é€
          git push --force --quiet gitlab main:main
          echo "âœ… Synchronization complete!"
